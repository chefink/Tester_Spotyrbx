pcall(function()

--// =====================================
--// ðŸŽ§ SPOTYRBX V1.6 â€” by Fbn
--// Estrutura preservada
--// Equalizador REAL por volume
--// Menu de volume separado
--// Tudo em pcall
--// =====================================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")
local player = Players.LocalPlayer

-- ===== GUI =====
local gui = Instance.new("ScreenGui")
gui.Name = "Spotyrbx"
pcall(function() gui.Parent = player:WaitForChild("PlayerGui") end)

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromOffset(260, 260)
main.Position = UDim2.fromScale(0.5, 0.5)
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 16)

-- TÃ­tulo
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, 0, 0, 32)
title.BackgroundTransparency = 1
title.Text = "ðŸŽ§ Spotyrbx"
title.TextColor3 = Color3.fromRGB(0,255,0)
title.Font = Enum.Font.GothamBold
title.TextSize = 16

-- SubtÃ­tulo
local subtitle = Instance.new("TextLabel", main)
subtitle.Size = UDim2.new(1,0,0,18)
subtitle.Position = UDim2.fromOffset(0,32)
subtitle.BackgroundTransparency = 1
subtitle.Text = "by Fbn"
subtitle.TextColor3 = Color3.fromRGB(0,200,0)
subtitle.Font = Enum.Font.Gotham
subtitle.TextSize = 12

-- BotÃ£o fechar
local closeBtn = Instance.new("TextButton", main)
closeBtn.Size = UDim2.fromOffset(26,26)
closeBtn.Position = UDim2.fromOffset(228,4)
closeBtn.Text = "âœ•"
closeBtn.BackgroundTransparency = 1
closeBtn.TextColor3 = Color3.fromRGB(255,80,80)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14

-- BotÃ£o minimizar
local minBtnTop = Instance.new("TextButton", main)
minBtnTop.Size = UDim2.fromOffset(26,26)
minBtnTop.Position = UDim2.fromOffset(200,4)
minBtnTop.Text = "â€”"
minBtnTop.BackgroundTransparency = 1
minBtnTop.TextColor3 = Color3.fromRGB(0,255,0)
minBtnTop.Font = Enum.Font.GothamBold
minBtnTop.TextSize = 14

-- ===== Playlist vazia =====
local playlist = {}
local currentIndex = 1
local shuffle = false
local loop = false

-- ===== SoundGroup dedicado =====
local soundGroup = Instance.new("SoundGroup", SoundService)
soundGroup.Name = "SpotyrbxGroup"

-- ===== Som central =====
local soundPart = Instance.new("Part", Workspace)
soundPart.Anchored = true
soundPart.CanCollide = false
soundPart.Size = Vector3.new(1,1,1)
soundPart.Transparency = 1

pcall(function()
	if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
		soundPart.Position = player.Character.HumanoidRootPart.Position
	end
end)

local sound = Instance.new("Sound", soundPart)
sound.Volume = 0.65
sound.MaxDistance = 80
sound.RollOffMode = Enum.RollOffMode.Linear
sound.SoundGroup = soundGroup

-- ===== FUNÃ‡Ã•ES =====
local function playSong(index)
	if #playlist == 0 then return end
	currentIndex = index
	sound.SoundId = "rbxassetid://"..playlist[currentIndex]
	sound.Looped = loop
	sound:Play()
end

local function nextSong()
	if #playlist == 0 then return end
	if shuffle then
		currentIndex = math.random(1,#playlist)
	else
		currentIndex += 1
		if currentIndex > #playlist then currentIndex = 1 end
	end
	playSong(currentIndex)
end

local function prevSong()
	if #playlist == 0 then return end
	if shuffle then
		currentIndex = math.random(1,#playlist)
	else
		currentIndex -= 1
		if currentIndex < 1 then currentIndex = #playlist end
	end
	playSong(currentIndex)
end

local function togglePlay()
	if sound.IsPlaying then
		sound:Pause()
	else
		sound:Play()
	end
end

-- ===== INPUT DE ID =====
local idBox = Instance.new("TextBox", main)
idBox.Size = UDim2.fromOffset(140,24)
idBox.Position = UDim2.fromOffset(50,60)
idBox.PlaceholderText = "Cole o ID da mÃºsica"
idBox.Text = ""
idBox.ClearTextOnFocus = false
idBox.BackgroundColor3 = Color3.fromRGB(35,35,35)
idBox.TextColor3 = Color3.fromRGB(0,255,0)
idBox.Font = Enum.Font.Gotham
idBox.TextSize = 14
Instance.new("UICorner", idBox).CornerRadius = UDim.new(0,6)

local addBtn = Instance.new("TextButton", main)
addBtn.Size = UDim2.fromOffset(40,24)
addBtn.Position = UDim2.fromOffset(195,60)
addBtn.Text = "+"
addBtn.BackgroundColor3 = Color3.fromRGB(35,35,35)
addBtn.TextColor3 = Color3.fromRGB(0,255,0)
addBtn.Font = Enum.Font.GothamBold
addBtn.TextSize = 14
Instance.new("UICorner", addBtn).CornerRadius = UDim.new(0,6)

addBtn.MouseButton1Click:Connect(function()
	pcall(function()
		local id = idBox.Text:gsub("%D","")
		if id ~= "" then
			table.insert(playlist,id)
			currentIndex = #playlist
			playSong(currentIndex)
			idBox.Text = ""
		end
	end)
end)

-- ===== BOTÃ•ES =====
local function makeBtn(text,x,y)
	local b = Instance.new("TextButton", main)
	b.Size = UDim2.fromOffset(40,36)
	b.Position = UDim2.fromOffset(x,y)
	b.Text = text
	b.BackgroundColor3 = Color3.fromRGB(35,35,35)
	b.TextColor3 = Color3.fromRGB(0,255,0)
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	Instance.new("UICorner", b).CornerRadius = UDim.new(0,12)
	return b
end

local prevBtn = makeBtn("â®", 10, 100)
local playBtn = makeBtn("â–¶ï¸", 95, 100)
local nextBtn = makeBtn("â­", 180, 100)
local shuffleBtn = makeBtn("ðŸ”€ OFF", 10, 150)
local loopBtn = makeBtn("ðŸ” OFF", 180, 150)

-- ===== Barra de tempo =====
local barBG = Instance.new("Frame", main)
barBG.Size = UDim2.fromOffset(200,6)
barBG.Position = UDim2.fromOffset(30,205)
barBG.BackgroundColor3 = Color3.fromRGB(50,50,50)
barBG.BorderSizePixel = 0
Instance.new("UICorner", barBG).CornerRadius = UDim.new(1,0)

local barFill = Instance.new("Frame", barBG)
barFill.Size = UDim2.fromScale(0,1)
barFill.BackgroundColor3 = Color3.fromRGB(0,255,0)
barFill.BorderSizePixel = 0
Instance.new("UICorner", barFill).CornerRadius = UDim.new(1,0)

-- ===== Equalizador REAL =====
local eqContainer = Instance.new("Frame", main)
eqContainer.Size = UDim2.fromOffset(220,40)
eqContainer.Position = UDim2.fromOffset(20,165)
eqContainer.BackgroundTransparency = 1

local bars = {}
local peakLevels = {}

for i = 1, 12 do
	local bar = Instance.new("Frame", eqContainer)
	bar.Size = UDim2.fromScale(0.06,0.2)
	bar.Position = UDim2.fromScale((i-1)*0.08,0.8)
	bar.BackgroundColor3 = Color3.fromRGB(0,255,0)
	bar.BorderSizePixel = 0
	Instance.new("UICorner", bar).CornerRadius = UDim.new(0,10)
	bars[i] = bar
	peakLevels[i] = 0
end

local eqRunning = false

local function startEQ()
	if eqRunning then return end
	eqRunning = true
	task.spawn(function()
		while eqRunning do
			for i,bar in ipairs(bars) do
				local level = sound.PlaybackLoudness or 0
				local normalized = math.clamp(level / 500, 0.05, 1)

				local height = normalized * math.random(70,100)/100
				local y = 1 - height

				TweenService:Create(bar,TweenInfo.new(0.1,Enum.EasingStyle.Quart,Enum.EasingDirection.Out),{
					Size = UDim2.fromScale(0.06,height),
					Position = UDim2.fromScale((i-1)*0.08,y)
				}):Play()
			end
			task.wait(0.08)
		end
	end)
end

local function stopEQ()
	eqRunning = false
	for i,bar in ipairs(bars) do
		TweenService:Create(bar,TweenInfo.new(0.2),{
			Size = UDim2.fromScale(0.06,0.2),
			Position = UDim2.fromScale((i-1)*0.08,0.8)
		}):Play()
	end
end

-- ===== MINI BOLHA ðŸŽ§ =====
local bubble = Instance.new("TextButton", gui)
bubble.Size = UDim2.fromOffset(50,50)
bubble.Position = UDim2.fromScale(0.5,0.5)
bubble.AnchorPoint = Vector2.new(0.5,0.5)
bubble.BackgroundColor3 = Color3.fromRGB(20,20,20)
bubble.Text = "ðŸŽ§"
bubble.TextSize = 24
bubble.TextColor3 = Color3.fromRGB(0,255,0)
bubble.Visible = false
Instance.new("UICorner", bubble).CornerRadius = UDim.new(1,0)

local dragging = false
local dragStart, startPos

local function makeDrag(obj)
	obj.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = obj.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	obj.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			if dragging then
				local delta = input.Position - dragStart
				obj.Position = UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
			end
		end
	end)
end

makeDrag(bubble)

-- ===== MENU DE VOLUME =====
local volumeBtn = Instance.new("TextButton", main)
volumeBtn.Size = UDim2.fromOffset(26,26)
volumeBtn.Position = UDim2.fromOffset(10,4)
volumeBtn.Text = "ðŸ”Š"
volumeBtn.BackgroundTransparency = 1
volumeBtn.TextColor3 = Color3.fromRGB(0,255,0)
volumeBtn.Font = Enum.Font.GothamBold
volumeBtn.TextSize = 14

local volumeFrame = Instance.new("Frame", main)
volumeFrame.Size = UDim2.fromOffset(180,60)
volumeFrame.Position = UDim2.fromOffset(40,40)
volumeFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
volumeFrame.Visible = false
volumeFrame.BorderSizePixel = 0
Instance.new("UICorner", volumeFrame).CornerRadius = UDim.new(0,12)

local volLabel = Instance.new("TextLabel", volumeFrame)
volLabel.Size = UDim2.new(1,0,0,24)
volLabel.BackgroundTransparency = 1
volLabel.Text = "Volume"
volLabel.TextColor3 = Color3.fromRGB(0,255,0)
volLabel.Font = Enum.Font.GothamBold
volLabel.TextSize = 14

local volBarBG = Instance.new("Frame", volumeFrame)
volBarBG.Size = UDim2.fromOffset(150,6)
volBarBG.Position = UDim2.fromOffset(15,36)
volBarBG.BackgroundColor3 = Color3.fromRGB(50,50,50)
volBarBG.BorderSizePixel = 0
Instance.new("UICorner", volBarBG).CornerRadius = UDim.new(1,0)

local volBarFill = Instance.new("Frame", volBarBG)
volBarFill.Size = UDim2.fromScale(0.65,1)
volBarFill.BackgroundColor3 = Color3.fromRGB(0,255,0)
volBarFill.BorderSizePixel = 0
Instance.new("UICorner", volBarFill).CornerRadius = UDim.new(1,0)

local draggingVol = false

volBarBG.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		draggingVol = true
	end
end)

volBarBG.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		draggingVol = false
	end
end)

volBarBG.InputChanged:Connect(function(input)
	if draggingVol and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		pcall(function()
			local rel = (input.Position.X - volBarBG.AbsolutePosition.X) / volBarBG.AbsoluteSize.X
			rel = math.clamp(rel,0,1)
			volBarFill.Size = UDim2.fromScale(rel,1)
			sound.Volume = rel
		end)
	end
end)

volumeBtn.MouseButton1Click:Connect(function()
	pcall(function()
		volumeFrame.Visible = not volumeFrame.Visible
	end)
end)

-- ===== Eventos =====
playBtn.MouseButton1Click:Connect(function()
	pcall(function()
		togglePlay()
		if sound.IsPlaying then
			startEQ()
		else
			stopEQ()
		end
	end)
end)

nextBtn.MouseButton1Click:Connect(function()
	pcall(nextSong)
end)

prevBtn.MouseButton1Click:Connect(function()
	pcall(prevSong)
end)

shuffleBtn.MouseButton1Click:Connect(function()
	pcall(function()
		shuffle = not shuffle
		shuffleBtn.Text = shuffle and "ðŸ”€ ON" or "ðŸ”€ OFF"
	end)
end)

loopBtn.MouseButton1Click:Connect(function()
	pcall(function()
		loop = not loop
		loopBtn.Text = loop and "ðŸ” ON" or "ðŸ” OFF"
	end)
end)

closeBtn.MouseButton1Click:Connect(function()
	pcall(function()
		gui:Destroy()
	end)
end)

minBtnTop.MouseButton1Click:Connect(function()
	pcall(function()
		main.Visible = false
		bubble.Visible = true
	end)
end)

bubble.MouseButton1Click:Connect(function()
	pcall(function()
		main.Visible = true
		bubble.Visible = false
	end)
end)

-- ===== Auto avanÃ§ar =====
sound.Ended:Connect(function()
	pcall(function()
		if loop then
			playSong(currentIndex)
		else
			nextSong()
		end
	end)
end)

-- ===== AtualizaÃ§Ãµes =====
RunService.RenderStepped:Connect(function()
	pcall(function()
		if sound.TimeLength > 0 then
			barFill.Size = UDim2.fromScale(sound.TimePosition / sound.TimeLength,1)
		end
		if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			soundPart.Position = player.Character.HumanoidRootPart.Position
		end
	end)
end)

print("ðŸŽ§ Spotyrbx V1.6 carregado â€” Equalizador REAL ativo!")

end)
